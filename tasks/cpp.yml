---
- name: Download vscode-cpptools
  become_user: "{{ lookup('env', 'USER' }}"
  get_url:
    url: https://github.com/microsoft/vscode-cpptools/releases/download/1.7.1/cpptools-linux.vsix
    dest: "{{ lookup('env', 'USER') }}"
  tags:
  - cpp
- name: Create cpptools directory
  become_user: "{{ lookup('env', 'USER' }}"
  file:
    path: "/home/{{ lookup('env', 'USER') }}/.cpptools"
    state: directory
  tags:
  - cpp
- name: Extract cpptools
  become_user: "{{ lookup('env', 'USER' }}"
  shell: "unzip /home/{{ lookup('env', 'USER') }}/cpptools-linux.vsix -d  /home/{{ lookup('env', 'USER') }}/.cpptools/cpptools-linux"
  tags:
  - cpp
- name: Make cpptools an executable
  become_user: "{{ lookup('env', 'USER' }}"
  shell: "chmod +x /home/{{ lookup('env', 'USER') }}/.cpptools/cpptools-linux/extension/debugAdapters/bin/OpenDebugAD7"
  tags:
  - cpp
- name: Create copy of json config
  become_user: "{{ lookup('env', 'USER' }}"
  shell: "cp /home/{{ lookup('env', 'USER') }}/.cpptools/cpptools-linux/extension/debugAdapters/bin/cppdbg.ad7Engine.json /home/{{ lookup('env', 'USER') }}/.cpptools/cpptools-linux/extension/debugAdapters/bin/nvim-dap.ad7Engine.json"
  tags:
  - cpp
- name: Install lldb-vscode debugger adapter
  shell: 'cd /usr/local/bin && curl https://github.com/lanza/lldb-vscode/raw/master/bin/darwin/bin/lldb-vscode >> /usr/local/bin/lldb-vscode && chmod +x /usr/local/bin/lldb-vscode && ln -s /usr/local/bin/lldb-vscode /usr/bin/lldb-vscode'
  tags:
  - cpp

---
- name: Download spotify apt keys
  shell: curl -sS https://download.spotify.com/debian/pubkey_5E3C45D7B312C643.gpg | apt-key add -
  become: true
  tags:
  - spotify
- name: Add spotify to sources list
  shell: echo "deb http://repository.spotify.com stable non-free" | tee /etc/apt/sources.list.d/spotify.list
  become: true
  tags:
  - spotify
- name: Update and upgrade apt packages
  become: true
  apt:
    upgrade: yes
    update_cache: yes
  tags:
  - spotify
- name: Install Spotify
  become: true
  apt:
    name: ["spotify-client"]
  tags:
  - spotify
- name: Add write permission to Spotify files
  become: true
  shell: chmod a+wr /usr/share/spotify && chmod a+wr /usr/share/spotify/Apps -R
  tags:
  - spotify
- name: Install Spicetify
  shell: curl -fsSL https://raw.githubusercontent.com/khanhas/spicetify-cli/master/install.sh | sh
  tags:
  - spotify
- name: Create initial config file
  command:
    cmd: spicetify
    creates: "{{ main_user_dir }}/.config/spicetify/config.ini"
  tags:
  - spotify
- name: Check current theme
  command: spicetify config current_theme
  check_mode: false
  register: current_theme
  tags:
  - spotify
- name: Set theme
  command: spicetify config current_theme Nord
  when: '"Nord" not in current_theme.stdout'
  tags:
  - spotify
- name: Apply theme
  command: spicetify backup apply
  when: '"Nord" not in current_theme.stdout'
  tags:
  - spotify

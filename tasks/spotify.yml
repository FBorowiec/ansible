---
- name: Download spotify apt keys
  shell: curl -sS https://download.spotify.com/debian/pubkey_5E3C45D7B312C643.gpg | apt-key add -
  become: true
  tags:
  - spotify
- name: Add spotify to sources list
  shell: echo "deb http://repository.spotify.com stable non-free" | tee /etc/apt/sources.list.d/spotify.list
  become: true
  tags:
  - spotify
- name: Update and upgrade apt packages
  become: true
  apt:
    upgrade: yes
    update_cache: yes
  tags:
  - spotify
- name: Install Spotify
  become: true
  apt:
    name: ["spotify-client"]
  tags:
  - spotify
- name: Add write permission to Spotify files
  become: true
  shell: chmod a+wr /usr/share/spotify && chmod a+wr /usr/share/spotify/Apps -R
  tags:
  - spotify
- name: Install Spicetify
  become: yes
  become_user: "{{ main_user }}"
  shell: curl -fsSL https://raw.githubusercontent.com/khanhas/spicetify-cli/master/install.sh | sh
  tags:
  - spotify
- name: Enable Dribbblish extensions
  become: yes
  become_user: "{{ main_user }}"
  command: cd {{ HOME_USER_DIR }}/.config/spicetify/Themes/Dribbblish && spicetify config extensions dribbblish.js
  check_mode: false
  register: current_theme
  tags:
  - spotify
- name: Set theme
  become: yes
  become_user: "{{ main_user }}"
  command: spicetify config current_theme Dribbblish color_scheme nord-dark && spicetify config inject_css 1 replace_colors 1 overwrite_assets 1
  tags:
  - spotify
- name: Apply theme
  become: yes
  become_user: "{{ main_user }}"
  command: spicetify backup apply && spicetify apply
  tags:
  - spotify
